import os
import sys
from collections import defaultdict

if len(sys.argv) != 3:
    print("Usage: python wordlist_merge.py <directory> <output_file>")
    sys.exit(1)

directory = sys.argv[1]
output_filename = sys.argv[2]

if not os.path.isdir(directory):
    print(f"{directory} is not a valid directory")
    sys.exit(1)

counts = defaultdict(int)

for filename in os.listdir(directory):
    if os.path.isfile(os.path.join(directory, filename)) and not filename.endswith('.json'):
        with open(os.path.join(directory, filename), 'r') as file:
            for word in file:
                word = word.strip()
                if word:
                    counts[word] += 1

# Sort the words by count and then alphabetically
sorted_words = sorted(counts.keys(), key=lambda x: (-counts[x], x))

# Create a new output file for the unique words
with open(output_filename, "w") as output_file:
    for word in sorted_words:
        output_file.write(f"{word}\n")

total_words = sum(counts.values())
print(f"Unique words written to {output_filename}. Total words written: {total_words}")

